#!/bin/bash

HOSTNAME=${1:-$(hostname)}

if [[ "${HOSTNAME}" == "" ]]; then
    echo "Usage: pro <hostname>"
    exit -1
fi

set -e

SRC_DIRECTORY="${HOME}/src"
LIB_DIRECTORY="${HOME}/lib"
ANSIBLE_DIRECTORY="${LIB_DIRECTORY}/ansible"
ANSIBLE_PLAYBOOKS_DIRECTORY="${SRC_DIRECTORY}/ansible-playbooks"

echo "Bootstrap Ansible"
source ${ANSIBLE_PLAYBOOKS_DIRECTORY}/bootstrap/ssh-key
source ${ANSIBLE_PLAYBOOKS_DIRECTORY}/bootstrap/xcode
source ${ANSIBLE_PLAYBOOKS_DIRECTORY}/bootstrap/homebrew
source ${ANSIBLE_PLAYBOOKS_DIRECTORY}/bootstrap/pyenv
source ${ANSIBLE_PLAYBOOKS_DIRECTORY}/bootstrap/ansible
source ${ANSIBLE_PLAYBOOKS_DIRECTORY}/bootstrap/ansible-playbooks

echo "Provision with Ansible"
cd ${ANSIBLE_PLAYBOOKS_DIRECTORY}
ansible-playbook playbooks/macbook.yml -e "hostname=${HOSTNAME}"
